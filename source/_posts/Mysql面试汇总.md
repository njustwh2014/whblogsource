---
title: Mysql面试汇总
date: 2020-03-13 20:59:55
tags: 
    - Mysql
categories: 求职
---

## 数据库三大范式

一般地，在进行数据库设计时，应遵循三大原则，也就是我们通常说的三大范式：
+ 第一范式要求确保表中每列的原子性，也就是不可拆分；
+ 第二范式要求确保表中每列与主键相关，而不能只与主键的某部分相关（主要针对联合主键[什么是联合主键]），主键列与非主键列遵循完全函数依赖关系，也就是完全依赖；
+ 第三范式确保主键列之间没有传递函数依赖关系，也就是消除传递依赖。

## 数据库索引

### 索引有哪几种

### 索引的底层实现 B+树和红黑树、B树比较

### 索引失效

### 索引优化策略

### `explain`慢查询优化

## Mysql事务

### 事务特性(ACID)

+ 原子性（atomicity，或稱不可分割性）
+ 一致性（consistency）
+ 隔离性（isolation，又称独立性）
+ 持久性（durability）

### 事务的隔离级别(读未提交、读已提交、重复读、序列化)

[参考文章](https://blog.csdn.net/JIESA/article/details/51317164)

+ 读未提交：可以读到另外事务未提交的写，会造成脏读
+ 读已提交：可以读到另外事务已提交的写，但可能造成不可重复读
+ 重复读：在事务写的时候，别的事务不可写。可能造成幻读。Mysql默认隔离级别，MVCC解决幻读
+ 序列化：事务顺序执行，不仅可以避免脏读、不可重复读，还避免了幻像读，通过加X锁，开销太大。([X锁-排他锁，S锁-共享锁](https://blog.csdn.net/yuwei19840916/article/details/3245107))

### 事务的隔离级别分别解决哪些问题(脏读、不可重复读、幻读丢失修改)

### MVCC(多版本并发控制)

[参考文章](https://www.jianshu.com/p/f692d4f8a53e)

+ 数据行版本号
+ 删除版本号

### 事务的回滚(undo、redo日志)

[MYSQL 之DDL、DML、DCL、TCL的区别](https://blog.csdn.net/u012732259/article/details/39524405)

+ DDL:操作表结构的命令 如: CREATE、ALTER、DROP
+ DML：操作数据的命令 如select update delete insert

事务的回滚适用于DML，不适用于DDL

那么DDL事务回滚

先DCL 再 DDL 最后将DML放入事务中

## 存储引擎

### MyISAM与InnoDB的区别

### 上述存储引擎在索引结构方面的区别

### 各自的使用场景

## 锁(共享锁、排他锁、行锁、表锁、间隙锁)

[总结的很好](https://zhuanlan.zhihu.com/p/29150809)

### 如何避免死锁

## SQL语句(常见为聚类函数的使用、表连接查询)

## 分库分表策略

## SQL注入原理(常用SQL防注入框架)

## Mysql的sql处理过程

### Mysql逻辑分层

+ **第一层：Connect层**

**负责连接管理、授权认证、安全等等**

每个客户端的连接都对应着服务器上的一个线程。服务器上维护了一个线程池，避免为每个连接都创建销毁一个线程。当客户端连接到MySQL服务器时，服务器对其进行认证。可以通过用户名和密码的方式进行认证，也可以通过SSL证书进行认证。登录认证通过后，服务器还会验证该客户端是否有执行某个查询的权限。

+ **第二层：Service层**

**负责解析查询(编译SQL)，并对其进行优化(如调整表的读取顺序，选择合适的索引等)**。对于SELECT语句，在解析查询前，服务器会先检查查询缓存，如果能在其中找到对应的查询结果，则无需再进行查询解析、优化等过程，直接返回查询结果。存储过程、触发器、视图等都在这一层实现。

+ **第三层：存储引擎**

**存储引擎负责在MySQL中存储数据、提取数据、开启一个事务等等**。存储引擎通过API与上层进行通信，这些API屏蔽了不同存储引擎之间的差异，使得这些差异对上层查询过程透明。存储引擎不会去解析SQL。

### Mysql组件：

+ 1. 线程池组件（Connection Pool）：处理connetor发起的请求，处理用户登录、线程复用、连接数控制、内存检测和缓冲等功能

+ 2. 管理服务和工具组件（Mangerment Services & Utilities）主要是完成数据备份和恢复、复制、集群管理、配置、迁移和元数据

+ 3. SQL接口组件（Sql Interface）：进行DML、DLL、视图、存储过程、触发器等操作和管理，通过sql命令来获取查询结果

+ 4. 查询分析器组件（Parser）：这里接受并通过解析器来解析sql接口组件传递过来的sql语句，解析器通过词法分析和语法分析等步骤来验证sql的正确性，解析器是由Lex和YACC实现的，是一个很长的脚本
主要功能：
 - a . 将SQL语句分解成数据结构，并将这个结构传递到后续步骤，以后SQL语句的传递和处理就是基于这个结构的 
 - b.  如果在分解构成中遇到错误，那么就说明这个sql语句是不合理的

+ 5. 优化器组件（Optimizer）：用于优化查询sql

+ 6. 缓冲组件（Cache&Buffer）：将各个组件得出的结果缓冲起来，可以是查询结果，查询sql等等

+ 7. 插件式存储引擎（Storage Engines）：各种存储引擎插件，如myisam、innodb

+ 8. 物理文件（Files & Logs）：用于存储真正的数据，日志、索引和缓存等数据